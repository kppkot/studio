# Техническое Задание: RegexVision Pro - Текущее состояние и Стратегия Развития

**Дата:** 20.07.2024
**Версия документа:** 1.1

### 1. Введение и Цели Проекта

**RegexVision Pro** — это интерактивный веб-инструмент, предназначенный для визуального создания, тестирования, отладки и анализа регулярных выражений. Проект нацелен на упрощение работы с Regex для пользователей любого уровня, от новичков до опытных разработчиков, предоставляя интуитивно понятный интерфейс и мощные аналитические инструменты.

**Основные цели:**

*   **Снижение порога входа:** Сделать регулярные выражения доступными и понятными.
*   **Повышение производительности:** Ускорить процесс создания и отладки Regex.
*   **Улучшение качества Regex:** Помочь пользователям писать более эффективные и корректные выражения.
*   **Обучение:** Предоставить инструменты, способствующие изучению принципов работы Regex.

### 2. Основной Функционал и Пользовательское Взаимодействие

**2.1. Бизнес-концепция: Рабочий процесс пользователя**

Основная ценность RegexVision заключается в его **интерактивном рабочем цикле**, который превращает процесс создания Regex из линейного написания текста в динамичный и наглядный конструктор. Пользовательский опыт строится вокруг трех ключевых зон: **Конструктор (Дерево выражения)**, **Панель настроек** и **Зона тестирования**.

1.  **Конструирование (Что я хочу найти?):** Пользователь не пишет код, а собирает логику из готовых "кубиков" (`Block`). Вместо того чтобы вспоминать, как пишется незахватывающая группа `(?:...)`, он выбирает блок "Группа" и в настройках указывает тип "незахватывающая". Это фундаментально снижает когнитивную нагрузку и позволяет сосредоточиться на *логике*, а не на *синтаксисе*.

2.  **Настройка (Как именно это должно работать?):** Каждый блок в дереве — это не статичный элемент, а интерактивный объект. Выбрав блок, пользователь получает доступ к панели настроек, где он может тонко сконфигурировать его поведение. Например, для квантафикатора можно указать точное количество повторений и выбрать режим (жадный, ленивый). Это делает доступными сложные концепции, которые в текстовом виде часто упускаются из виду.

3.  **Тестирование (Работает ли это так, как я хочу?):** Это критически важный этап обратной связи. Как только пользователь вносит любое изменение в дерево или настройки, он **мгновенно** видит результат в зоне тестирования. Совпадения подсвечиваются, захваченные группы отображаются. Этот немедленный фидбэк превращает мучительный процесс "написал -> проверил -> не работает -> исправил" в плавный итеративный дизайн.

4.  **Экспорт (Как мне это использовать?):** Финальный этап — генерация кода. Когда пользователь доволен результатом, он может получить готовый фрагмент кода для своего языка программирования, что устраняет еще один барьер для применения созданного Regex в реальных проектах.

**2.2. Техническая реализация: Компоненты и Потоки Данных**

*   **Компонент-оркестратор (`RegexVisionWorkspace.tsx`):** Это "мозг" всего приложения. Он хранит основное состояние:
    *   `blocks`: Массив объектов, представляющих дерево выражения. **Это единственный источник правды.**
    *   `selectedBlockId`: ID блока, выбранного пользователем для редактирования.
    *   `testText` и `regexFlags`: Состояние тестовой строки и флагов.

*   **Компоненты-исполнители:**
    *   **`BlockNode.tsx`:** Отвечает за рендеринг одного блока в дереве. Получает объект блока как `prop` и отображает его в соответствии с типом и настройками. Он также обрабатывает пользовательские события (клик для выбора, drag-n-drop для перемещения) и сообщает о них "мозгу" через колбэки.
    *   **`SettingsPanel.tsx`:** Получает в качестве `prop` объект выбранного блока (`selectedBlock`). В зависимости от типа блока, рендерит соответствующий набор полей для редактирования. Любое изменение в полях вызывает колбэк `onUpdate`, который передается из `RegexVisionWorkspace`.
    *   **`TestArea.tsx` и `RegexOutputDisplay.tsx`:** Это "глупые" компоненты, которые просто отображают данные, полученные в `props` (`matches`, `generatedRegex`). Они не содержат сложной логики.

*   **Поток данных (Data Flow):**
    1.  **"Вниз" (Props):** `RegexVisionWorkspace` передает данные (например, массив `blocks` для отрисовки дерева или `selectedBlock` для панели настроек) дочерним компонентам через props.
    2.  **"Вверх" (Callbacks):** Когда пользователь взаимодействует с дочерним компонентом (например, нажимает кнопку "Удалить" в `BlockNode`), компонент вызывает функцию-колбэк (например, `handleDeleteBlock`), переданную ему из `RegexVisionWorkspace`.
    3.  **Обновление состояния:** `RegexVisionWorkspace` получает вызов колбэка и обновляет свое состояние (например, удаляет блок из массива `blocks`).
    4.  **Перерисовка:** React обнаруживает изменение состояния и запускает перерисовку `RegexVisionWorkspace` и всех его дочерних компонентов с новыми данными.

*   **Производное состояние (`Derived State`):** Строка Regex и массив совпадений (`matches`) не хранятся как основное состояние. Они **вычисляются** внутри хука `useEffect` в `RegexVisionWorkspace` каждый раз, когда изменяется массив `blocks`. Это гарантирует, что текстовое представление и результаты тестирования всегда на 100% синхронизированы с визуальным деревом.

### 3. Техническая архитектура и Фундамент

**3.1. Технологический стек:**
*   **Фреймворк:** Next.js (с App Router) — обеспечивает быструю загрузку, оптимизацию рендеринга (Server Components) и современную архитектуру.
*   **Язык:** TypeScript — для строгой типизации и повышения надежности кода.
*   **UI:** React в связке с библиотекой компонентов ShadCN UI — для быстрого создания профессионального, доступного и легко настраиваемого интерфейса.
*   **Стилизация:** Tailwind CSS — для утилитарного подхода к стилизации, с централизованной темой в `src/app/globals.css`, определяющей фирменный стиль проекта.
*   **Искусственный интеллект:** Genkit — для интеграции с моделями Google Gemini, что позволяет нам реализовывать "умные" функции, такие как генерация Regex из текста или его анализ.

**3.2. Фундаментальный принцип работы:**
Центральным элементом системы является не строка Regex, а **дерево объектов `Block`** (`src/components/regex-vision/types.ts`). Каждый объект `Block` — это логический "атом" выражения: литерал (`LITERAL`), квантификатор (`QUANTIFIER`), группа (`GROUP`) и так далее.

Пользователь взаимодействует с визуальным представлением этого дерева в компоненте `RegexVisionWorkspace`. Любое действие (добавление блока, изменение его настроек, удаление) обновляет состояние этого дерева в React.

Для синхронизации визуального дерева с текстовым представлением используется хук `useEffect`. Как только дерево `blocks` изменяется, вызывается утилитарная функция `generateRegexStringAndGroupInfo`. Она рекурсивно обходит дерево, генерирует из него финальную строку регулярного выражения и собирает информацию о захватывающих группах. Эта строка затем используется для обновления всех зависимых частей интерфейса: поля вывода, панели тестирования и генерации кода. Такой подход обеспечивает единый "источник правды" (дерево блоков) и гарантирует консистентность всего приложения.

### 4. Текущее Состояние Функционала (Июль 2024)

На данный момент RegexVision Pro включает следующие ключевые модули и функции:

**4.1. Визуальный Конструктор Регулярных Выражений:**

*   **Управление Блоками:** Пользователи могут добавлять, удалять, изменять порядок и конфигурировать различные типы блоков Regex:
    *   `LITERAL` (Литерал)
    *   `CHARACTER_CLASS` (Символьный класс)
    *   `QUANTIFIER` (Квантификатор)
    *   `GROUP` (Группа: захватывающая, незахватывающая, именованная)
    *   `ANCHOR` (Якорь: начало/конец строки, граница слова)
    *   `ALTERNATION` (Чередование `|`)
    *   `LOOKAROUND` (Просмотр: вперед/назад, позитивный/негативный)
    *   `BACKREFERENCE` (Обратная ссылка)
    *   `CONDITIONAL` (Условие)
*   **Панель Настроек:** Динамически отображает и позволяет изменять параметры выбранного блока.
*   **Палитра Блоков:**
    *   Позволяет добавлять новые блоки в конструктор.
    *   Включает базовый "Мастер" для быстрого добавления часто используемых конструкций (например, "любая цифра", "начало строки", "квантификатор", "просмотр").
    *   Интегрирован AI-помощник (`regexSuggestionFlow`): по запросу `/команда` предлагает простые Regex-блоки.
*   **Генерация Regex:** Автоматически формируется строка регулярного выражения на основе созданных блоков.
*   **Анализ Групп:** Извлекается информация о захватывающих группах (индекс, имя, ID блока).

**4.2. Тестирование и Отображение Результатов:**

*   **Область Тестирования (`TestArea`):**
    *   Позволяет вводить тестовую строку.
    *   Подсвечивает все совпадения с текущим Regex.
    *   Отображает список всех совпадений и их захваченных групп.
*   **Отображение Regex (`RegexOutputDisplay`):** Показывает сгенерированный Regex с цветовым выделением структурных частей, соответствующих блокам.
*   **Генерация Кода (`CodeGenerationPanel`):** Предоставляет готовые фрагменты кода для использования Regex в популярных языках программирования (JavaScript, Python, PHP, Java, C#).

**4.3. Интерактивность и UX:**

*   **Связь Конструктора и Результатов:**
    *   Клик по захваченной группе в `TestArea` выделяет соответствующий блок `GROUP` в конструкторе.
    *   Выбор блока `GROUP` или наведение на него курсора в конструкторе подсвечивает соответствующую группу в `TestArea`.
*   **Пользовательский Интерфейс:**
    *   Разработан на Next.js, React, с использованием ShadCN UI и Tailwind CSS.
    *   Адаптивные, изменяемые по размеру панели рабочей области.
    *   Поддержка клавиатурной навигации для выбора и управления блоками.
    *   Функции импорта/экспорта конфигурации рабочей области (блоки, флаги, тестовая строка).
    *   Система уведомлений (`toast`).

**4.4. PRO-Функции (в начальной стадии):**

*   **Визуальный Отладчик (`DebugView`):**
    *   Базовый UI: отображение Regex, тестовой строки, кнопок управления ("Начать", "Шаг", "Сброс").
    *   *Упрощенная имитация* пошагового выполнения:
        *   Примитивный "токенизатор" Regex (разбивает на символы, `\d`, `*`, простые группы).
        *   "Движок" перемещается по токенам Regex и символам тестовой строки.
        *   Поддерживает очень базовую логику для литералов, `\d`, `\s`, `\w`, `.`, `^`, `$`, и крайне упрощенную для `*`, `+`, `?`.
    *   Лог действий "движка".
    *   Подсветка текущего "токена" в Regex и позиции в тексте.
*   **Анализатор Производительности (`PerformanceAnalyzerView`):**
    *   Обнаруживает несколько распространенных паттернов, способных вызвать "катастрофический откат" (например, `(a+)+`, `(a*)*`, `a*a*`, `\d+\d*`).
    *   Выводит предупреждения с описанием проблемы и указанием на проблемный участок в Regex.
*   **Библиотека Паттернов (`PatternLibraryView`):**
    *   **Персональная библиотека:** Сохранение/загрузка паттернов (Regex, флаги, тестовая строка, описание) в `localStorage`.
    *   Просмотр, применение, удаление и **редактирование** сохраненных паттернов.
    *   **Интеграция с AI при применении:** При загрузке паттерна из библиотеки, AI (`naturalLanguageRegexFlow`) пытается разобрать строку Regex на визуальные блоки. В случае неудачи, Regex загружается как один `LITERAL` блок.

**4.5. Интеграция с Искусственным Интеллектом (Genkit):**

*   **`naturalLanguageRegexFlow`:** Преобразует запросы на естественном языке или существующие строки Regex в структурированное представление блоков и дает объяснение. Используется в Мастере Regex и при применении паттернов из Библиотеки.
*   **`regexSuggestionFlow`:** Предоставляет быстрые одноблочные Regex-подсказки в Палитре Блоков.

### 5. Стратегия Развития и Будущие Цели

**5.1. Бизнес-концепция: От Инструмента к Интеллектуальной Платформе**

Наш следующий стратегический шаг — превратить RegexVision из мощного, но пассивного *инструмента* в проактивную, интеллектуальную *платформу-помощника*. Мы хотим не просто давать пользователю "удочку", но и подсказывать, где "рыба", и обучать его "рыбачить" эффективнее.

**Ключевые направления развития:**

1.  **Глубокая Интеграция ИИ:** ИИ должен стать не просто генератором по запросу, а настоящим "штурманом" в процессе. Он будет проактивно анализировать действия пользователя, предлагать оптимизации, объяснять сложные концепции и предсказывать потенциальные проблемы до их возникновения.
2.  **Обучение и Развитие Навыков:** RegexVision должен стать лучшим местом для изучения регулярных выражений. Мы планируем внедрить интерактивные уроки и "песочницы", где пользователь сможет на практике, под руководством ИИ-ментора, освоить все тонкости — от базовых символов до продвинутых техник.
3.  **Совместная Работа и Обмен Знаниями:** Регулярные выражения часто используются в командах. Мы дадим возможность создавать общие библиотеки паттернов, делиться ссылками на рабочую область с коллегами для совместного решения задач и обсуждения.
4.  **Расширение PRO-функционала:** Мы углубим и доведем до совершенства существующие "PRO" функции, превратив их из демонстрационных в незаменимые инструменты для профессионалов.

**5.2. Техническая реализация: Дорожная Карта**

*   **Этап 1: "ИИ-Ассистент"**
    *   **Разработка `analyzeRegexFlow`:** Создание нового Genkit flow, который будет принимать ошибочный Regex, цель пользователя и тестовый текст. На выходе flow будет давать пошаговое объяснение, *почему* выражение не работает, и предлагать конкретные исправления. Эта функция станет основой для умного "помощника по отладке".
    *   **Доработка `PerformanceAnalyzerView`:** Интегрировать новый `optimizeRegexFlow`, который будет анализировать текущее выражение на предмет производительности и предлагать более эффективные альтернативы (например, замена `a*a*` на `a*`, предложение атомарных групп для предотвращения "отката").
    *   **Контекстные Подсказки:** Внедрить логику, которая будет анализировать текущее дерево блоков и предлагать релевантные следующие шаги или предупреждать о нелогичных конструкциях в реальном времени.

*   **Этап 2: "Интерактивная Академия Regex"**
    *   **Создание Модуля Интерактивных Уроков:** Разработать компонент `InteractiveTutorial.tsx`, который будет вести пользователя по заранее определенным сценариям ("Урок 1: Основы", "Урок 5: Магия Lookarounds"). Этот модуль будет использовать и расширять логику `GuidedStepsPanel`, предоставляя теорию и практические задания.
    *   **Режим "Что если?":** Позволить пользователю кликнуть на любую часть своего выражения и получить от ИИ объяснение, что именно она делает, и как изменится результат, если ее убрать или заменить.

*   **Этап 3: "Командная Работа"**
    *   **Облачные Библиотеки:** Перейти от `localStorage` к облачной базе данных (например, Firebase Firestore) для хранения библиотек паттернов. Это потребует внедрения системы аутентификации пользователей.
    *   **Состояние в URL:** Реализовать сериализацию состояния рабочей области (блоки, флаги, текст) в параметры URL. Это позволит делиться ссылкой на полностью воспроизводимую рабочую сессию. `RegexVisionWorkspace` будет проверять наличие этих параметров при монтировании и инициализировать свое состояние.

*   **Этап 4: "Настоящий PRO"**
    *   **Полноценный Визуальный Отладчик:** Это самая амбициозная задача. Она потребует создания собственного, "инспектируемого" движка регулярных выражений на JavaScript/TypeScript. Этот движок должен будет на каждом шаге исполнения предоставлять свое внутреннее состояние (текущая позиция в тексте, текущий токен в выражении, стек состояний для отката), которое `DebugView.tsx` будет визуализировать.
