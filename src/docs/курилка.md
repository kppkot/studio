
# Фишка из Курилки: Двухэтапный AI для исправления Regex

Привет! Раз уж мы тут неформально общаемся, хочу подсветить одно техническое решение в этом проекте, которое я считаю особенно крутым и элегантным. Это то, как работает кнопка **"Попробовать исправить"**.

### Проблема: "Глупый, но старательный" AI

Изначально, когда AI получал задачу "исправь этот сломанный Regex", он пытался сделать всё за один присест:
1.  Понять, в чем была изначальная цель пользователя.
2.  Проанализировать, что не так в текущем (сломанном) выражении.
3.  Придумать правильное решение.
4.  Сгенерировать корректные визуальные блоки.

Для сложных случаев это слишком много одновременных задач. В результате AI часто "галлюцинировал" — он мог уловить общую идею, но ошибался в деталях, предлагая новое, но тоже некорректное решение. Это как попросить человека написать эссе, глядя на него всего одну секунду.

### Решение: "Принцип Экспертного Совета"

Вместо одного "универсального солдата" я построил двухэтапный конвейер из двух узкоспециализированных AI-агентов, которые работают последовательно. Это имитирует то, как работают люди-эксперты.

**Этап 1: AI-Аналитик (`analyzeRegexFlow`)**

*   **Задача:** Только одно — проанализировать проблему и составить подробный отчет.
*   **Вход:** Изначальная цель, сломанный Regex, тестовый текст, ошибка.
*   **Выход:** Детальное, структурированное объяснение на естественном языке, *почему* текущий Regex не работает. Например: "Твой Regex ищет `^#`, но в тестовом тексте решетка находится в середине строки, а не в начале. Поэтому совпадений нет."
*   **Аналогия:** Это как старший разработчик, который не пишет код сам, а делает ревью и оставляет подробный комментарий в задаче.

**Этап 2: AI-Инженер (`fixRegexFlow`)**

*   **Задача:** Получив готовый анализ, сгенерировать правильное выражение.
*   **Вход:** Все то же, что и у Аналитика, **ПЛЮС** его детальный отчет.
*   **Промпт для Инженера звучит так:** "Вот заключение от твоего доверенного коллеги-аналитика. **Доверься ему полностью.** Используя этот анализ как основу, построй правильное визуальное выражение."
*   **Аналогия:** Это как миддл-разработчик, который получает четкое ТЗ от старшего коллеги и реализует его.

### Почему это круто?

1.  **Надежность:** Разделение задачи на "подумать" и "сделать" резко снижает когнитивную нагрузку на AI и уменьшает вероятность "галлюцинаций". Результаты становятся гораздо более точными и предсказуемыми.
2.  **Эффективность:** Каждый AI сфокусирован на своей сильной стороне. Один отлично анализирует и пишет тексты, другой — конструирует структурированные данные (JSON с блоками).
3.  **Отладка:** Если что-то идет не так, мы можем посмотреть на "отчет" от первого AI и понять, на каком именно этапе возникла ошибка — в анализе или уже в генерации.
4.  **Человекоподобный подход:** Это отражает принцип "сначала подумай, потом сделай", что является основой для решения сложных задач.

Этот паттерн, известный как **"Reflection"** или **"Chain-of-Thought"** в AI-инженерии, является одним из самых мощных способов заставить большие языковые модели решать сложные задачи более надежно. И он отлично вписался в наш RegexVision!
